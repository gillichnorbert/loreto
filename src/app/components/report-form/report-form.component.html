<div class="container" role="main" aria-labelledby="pageTitle">
  
  <div class="card-header text-center ">
    <div class="logo-wrapper py-2">
      <img src="logo-eticalidad.png" alt="logo" class="logo">
    </div>
  </div>

  <div class="card-body p-4 p-md-5">
    <form [formGroup]="reportForm" (ngSubmit)="onSave()" class="needs-validation" novalidate>
      
      <div class="row g-3">

        <div class="col-12">
          <label for="id" class="form-label">ID interno</label>
          <input id="id" type="text" class="form-control" formControlName="id">
        </div>

        <div class="col-md-6">
          <label for="client" class="form-label">Cliente / Comprador</label>
          <input id="client" type="text" class="form-control" placeholder="Nombre o ID del cliente" formControlName="client">
        </div>

        <div class="col-md-6">
          <label for="orderNumber" class="form-label">NÃºmero de pedido</label>
          <input id="orderNumber" type="number" class="form-control" placeholder="Ingrese el nÃºmero de pedido" formControlName="orderNumber">
        </div>

        <div class="col-md-6">
          <label for="brand" class="form-label">Marca</label>
          <select id="brand" class="form-select" formControlName="brand">
            <option value="">Seleccione una marca</option>
            <option value="Renault/Dacia">Renault / Dacia</option>
            <option value="Stellantis">Stellantis</option>
            <option value="Nissan">Nissan</option>
            <option value="Kia">Kia</option>
            <option value="MG">MG</option>
            <option value="Omoda">Omoda</option>
            <option value="Jaecoo">Jaecoo</option>
          </select>
        </div>

        <div class="col-md-6">
          <label for="part" class="form-label">Pieza</label>
          <input id="part" type="text" class="form-control" placeholder="Nombre o nÃºmero de pieza" formControlName="part">
        </div>

        <div class="col-md-6">
          <label for="reason" class="form-label">Motivo de devoluciÃ³n</label>
          <select id="reason" class="form-select" formControlName="reason">
            <option value="">Seleccione el motivo</option>
            <option value="">Retorno de pieza nueva</option>
            <option value="Calidad">Calidad</option>
            <option value="GarantÃ­a">GarantÃ­a</option>
            <option value="Casco / ProvisiÃ³n">Casco / ProvisiÃ³n</option>
          </select>
        </div>

        <div class="col-md-6">
          <label for="status" class="form-label">Estado</label>
          <select id="status" class="form-select" formControlName="status">
            <option value="">Seleccione el estado</option>
            <option value="Enviado a fÃ¡brica">Enviado a fÃ¡brica</option>
            <option value="Pagado">Pagado</option>
            <option value="Rechazado">Rechazado</option>
            <option value="Rechazado">Aceptada</option>
          </select>
        </div>

        <div class="col-12">
          <label for="comment" class="form-label">Comentario interno</label>
          <textarea id="comment" class="form-control" placeholder="Notas internas..." formControlName="comment" rows="4"></textarea>
        </div>

        <div class="col-12">
          <label for="selectReport" class="form-label">Seleccionar reporte existente</label>
          <select id="selectReport" class="form-select" [value]="selectedReportId" (change)="onReportSelected($event)">
            <option value="">-- Ninguno --</option>
            <option *ngFor="let report of (reports$ | async)" [value]="report.id">
              {{ report.id }} â€” {{ report.orderNumber || 'sin pedido' }}
            </option>
          </select>
        </div>
        <div class="col-12">
          <label for="clientEmail" class="form-label form-label-sm">Email del Cliente</label>
          <input id="clientEmail" type="email" class="form-control form-control-sm" placeholder="cliente@ejemplo.com" formControlName="clientEmail">
        </div>

        <div class="col-12">
          <div class="d-flex flex-wrap align-items-center gap-2">
            
            <button type="button" (click)="onSave()" class="btn btn-success btn-lg px-4">ğŸ’¾ Guardar</button>
            <button type="button" (click)="onDelete()" class="btn btn-outline-danger">âŒ Borrar</button>
            <button type="button" (click)="onClearAll()" class="btn btn-outline-secondary btn-sm">ğŸ§¹ Borrar todo</button>
            <button type="button" (click)="onEmailReport()" class="btn btn-outline-info" title="Enviar por Email" *ngIf="selectedReportId">ğŸ“§ Email</button>
            
            <span class="badge text-bg-light ms-auto fs-6 border" style="padding: 0.6em 0.8em;">
              ğŸ“Š {{ (reports$ | async)?.length || 0 }} reportes
            </span>
          </div>
        </div>
        
        <div class="col-12">
          <div class="btn-group w-100" role="group" aria-label="Export/Import actions">
            <button type="button" (click)="onImportClick()" class="btn btn-outline-primary">ğŸ“‚ Importar CSV/XLSX</button>
            <button type="button" (click)="onExportCSV()" class="btn btn-outline-primary">ğŸ“ Exportar a Excel</button>
            <button type="button" (click)="onExportSelectedPDF()" class="btn btn-outline-primary">ğŸ“„ Exportar PDF</button>
          </div>
        </div>

         <div class="col-12">
           <button type="button" (click)="onArchive()" class="btn btn-outline-secondary btn-sm w-100">ğŸ—„ï¸ Archivado automÃ¡tico</button>
         </div>


        
      </div>
    </form>
  </div>
</div>

<input 
  type="file" 
  #fileInput 
  (change)="onFileSelected($event)"
  accept=".csv,.xlsx,.xls,.txt" 
  style="display:none"
>